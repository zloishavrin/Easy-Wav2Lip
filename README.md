[Google Colab](https://colab.research.google.com/drive/1Povck6gREYOd9eQnKNJABAqpxGZcCHXQ)

## Простота:
* Простая настройка и выполнение - локально и через Google Colab.
     * Не нужно возиться с ручной загрузкой и установкой зависимостей.
     * В Google Colab нужно выполнить только 2 ячейки.
     * Пользователям Windows нужен только один файл для установки, обновления и запуска.

# Установка:

### Для наиболее простого и совместимого способа использования этого инструмента используйте версию Google Colab:

### Google Colab:
[https://colab.research.google.com/drive/1Povck6gREYOd9eQnKNJABAqpxGZcCHXQ](https://colab.research.google.com/drive/1Povck6gREYOd9eQnKNJABAqpxGZcCHXQ)

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1Povck6gREYOd9eQnKNJABAqpxGZcCHXQ)

## Локальная установка:
Требования:
    Карта Nvidia с поддержкой CUDA 12.2
    Или
    Устройство MacOS, поддерживающее MPS через Apple Silicon или GPU AMD

### Ручная установка:
1. Убедитесь, что установлены и доступны через терминал следующие приложения:
      * Python 3.10 (я тестировал только [3.10.11](https://www.python.org/ftp/python/3.10.11/) - другие версии могут не работать!)
      * [Git](https://git-scm.com/)
      * Windows & Linux: Cuda (достаточно иметь последние версии драйверов Nvidia, я тестировал только 12.2)

2. После перехода в папку с Easy-Wav2Lip выполните следующие действия в терминале:

### Ручная установка для Windows:
Создайте venv, установите на него ffmpeg, а затем установите Easy-Wav2Lip:
1. Откройте cmd и перейдите в папку, в которую вы хотите установить EasyWav2Lip, используя cd 
EG:
`cd Documents`

2. Скопируйте и вставьте следующий код в окно cmd:
Примечание: В этом месте будет создано 2 папки: Easy-Wav2Lip и Easy-Wav2Lip-venv (изолированная установка python).
```
py -3.10 -m venv Easy-Wav2Lip-venv
Easy-Wav2Lip-venv\Scripts\activate
python -m pip install --upgrade pip
python -m pip install requests
set url=https://github.com/BtbN/FFmpeg-Builds/releases/download/latest/ffmpeg-master-latest-win64-gpl.zip
python -c "import requests; r = requests.get('%url%', stream=True); open('ffmpeg.zip', 'wb').write(r.content)"
powershell -Command "Expand-Archive -Path .\\ffmpeg.zip -DestinationPath .\\"
xcopy /e /i /y "ffmpeg-master-latest-win64-gpl\bin\*" .\Easy-Wav2Lip-venv\Scripts
del ffmpeg.zip
rmdir /s /q ffmpeg-master-latest-win64-gpl
git clone https://github.com/anothermartz/Easy-Wav2Lip.git
cd Easy-Wav2Lip
pip install -r requirements.txt
python install.py
```
Теперь запустите Easy-Wav2Lip:<br>
    3. Закройте и снова откройте cmd, затем перейдите в ту же директорию, что и в шаге 1.<br>
    4. Вставьте следующий код:
```
Easy-Wav2Lip-venv\Scripts\activate
cd Easy-Wav2Lip
call run_loop.bat
```

### Установка на MacOS и Linux (не проверено):
Создайте venv, установите на него ffmpeg, а затем установите Easy-Wav2Lip:
1. Откройте терминал и перейдите в папку, в которую вы хотите установить Easy0Wav2Kip, используя cd
EG:
`cd ~/Documents`

2. Скопируйте и вставьте следующий код в окно терминала:
Примечание: В этом месте будет создано 2 папки: Easy-Wav2Lip и Easy-Wav2Lip-venv (изолированная установка python).
```
python3.10 -m venv Easy-Wav2Lip-venv
source EW2Lvenv/bin/activate
python -m pip install --upgrade pip
python -m pip install requests
for file in ffmpeg ffprobe ffplay; do
    curl -O "https://evermeet.cx/ffmpeg/${file}-6.1.1.zip"
    unzip "${file}-6.1.1.zip"
done
mv -f ffmpeg ffprobe ffplay /Easy-Wav2Lip-venv/bin/
rm -f ffmpeg-6.1.1.zip ffprobe-6.1.1.zip ffplay-6.1.1.zip
source EW2Lvenv/bin/activate
git clone https://github.com/anothermartz/Easy-Wav2Lip.git
cd Easy-Wav2Lip
pip install -r requirements.txt
python install.py
```
Теперь запустите Easy-Wav2Lip:<br>
    3. Закройте и снова откройте cmd, затем перейдите в ту же директорию, что и в шаге 1.<br>
    4. Вставьте следующий код:
```
source Easy-Wav2Lip-venv/bin/activate
cd Easy-Wav2Lip
./run_loop.sh
```

## Использование:
* Когда все будет установлено, появится файл config.ini.
* Добавьте сюда путь (пути) к видео- и аудиофайлам и настройте параметры по своему вкусу.
<br><br>
    **Совет:**
     * В Windows удерживайте shift при нажатии правой кнопки мыши на файле, который вы хотите использовать, затем нажмите «a» или «скопировать как путь», и вы получите путь, который можно вставить как video_file или vocal_file.
     * MacOS: Щелкните правой кнопкой мыши на файле, удерживайте клавишу Option (Alt) и выберите в контекстном меню пункт «Копировать [имя файла] как путь».
<br><br>
* Сохраните config.ini и закройте его, это запустит процесс Wav2Lip, и ваш файл будет сохранен в той же директории, что и файл video_path.
* config.ini откроется снова, и вы сможете изменить вводимые данные и настройки.

# Рекомендации:
* Наилучшие результаты получаются, если привести речь в соответствие с действиями и выражением лица говорящего перед отправкой через wav2lip!

Видеофайлы:
* Во всех кадрах должно быть лицо, иначе Wav2Lip не будет работать
* * Обрезайте или маскируйте лица, которые вы не хотите синхронизировать по губам, или я выберу случайным образом.
* Используйте h264 .mp4 - могут поддерживаться другие типы файлов, но это то, что он выводит в виде
* Изображения в данный момент не тестировались.
* Используйте файлы небольшого размера во всех отношениях (попробуйте <720p, <30 секунд, 30 кадров в секунду и т.д. - Файлы большего размера могут работать, но обычно они являются причиной сбоя).
* Для первой попытки используйте очень маленький клип, просто чтобы привыкнуть к процессу, и только после того, как вы освоитесь, попробуйте файлы большего размера, чтобы посмотреть, работают ли они.

Аудиофайлы:
* Сохраняйте в формате .wav и той же длины, что и входное видео.
* ПРИМЕЧАНИЕ: я заметил, что из обработанного видео/аудио вырезается около 80 мс, и я не уверен, как это исправить, поэтому убедитесь, что у вас есть немного больше, чем вам действительно нужно!
* Вы можете просто закодировать его в свой видеофайл и оставить поле vocal_path пустым, но это увеличит время обработки на пару секунд, поскольку звук будет отделен от видео
* <b>ИЛИ </b>
* Выберите свой аудиофайл отдельно
* Я не уверен, какие типы файлов поддерживаются, по крайней мере.wav и .mp3 работают.

# Расширенная настройка:
## wav2lip_version:
| Опция | Плюсы | Минусы |
|:-------|:-----|:-----|
| Wav2Lip | + Более точная синхронизация по губам <br> + Попытка держать рот закрытым при отсутствии звука | - Иногда при этом выпадают зубы (необычно) |
| Wav2Lip_GAN | + Выглядит приятнее <br> + Лучше сохраняет оригинальную мимику говорящего | - Не так хорошо маскирует оригинальные движения губ, особенно при отсутствии звука |

Я предлагаю сначала попробовать Wav2Lip и переключиться на версию GAN, если вы испытываете эффект, при котором кажется, что у динамика большие промежутки между зубами.

### nosmooth:
* Если функция включена, wav2lip будет обрезать лицо в каждом кадре независимо.
  * Подходит для быстрых перемещений или вырезок в видео.
  * Может вызвать подергивание, если лицо расположено под странным углом.

* Если функция wav2lip отключена, она смешает обнаруженное положение лица между 5 кадрами.
  * Подходит для медленных движений, особенно для лиц, снятых под необычным углом.
  * Рот может быть смещен, когда лицо быстро перемещается в кадре, и выглядит ужасно между кадрами.

## Внутренние отступы:
Этот параметр определяет, сколько пикселей добавляется или удаляется при обрезке лица в каждом направлении.

| Значение | Пример | Эффект |
|:------|:--------|:-------|
| U | U = -5 | Удаляет 5 пикселов в верхней части лица |
| D | D = 10 | Добавляет 10 пикселов в нижнюю часть лица |
| L | L = 0 | Слева от лица никаких изменений |
| R | R = 15 | Добавляет 15 пикселей справа от лица |

Накладка может помочь устранить резкие линии на подбородке или других частях лица, но слишком большая или слишком маленькая накладка может изменить размер или положение рта. Обычно внизу добавляется 10 пикселей, но вам следует поэкспериментировать с разными значениями, чтобы найти наилучший баланс для вашего клипа.

## Маска:
Этот параметр определяет, как обработанное лицо будет смешиваться с исходным. Это не влияет на параметр "Быстрое" качество.

* **size** увеличивает размер области, которую закрывает маска.
* **smooth** определяет степень растушевки между центром маски и краями.
* **mouth_tracking** будет обновлять положение маски до того, где находится рот на каждом кадре (медленнее).
* **debug_mask** преобразует фон в оттенки серого, а маску - в цветную, чтобы вы могли легко увидеть, где находится маска в кадре.

# Другие опции:

### output_suffix:
Это добавляет суффикс к вашим выходным файлам, чтобы они не перезаписывали ваши оригиналы.

### include_settings_in_suffix:
Добавляет, какие настройки были использованы - удобно сравнивать разные настройки, так как вы будете знать, что вы использовали для каждого рендера.

### preview_input
Отображает входное видео / аудио перед обработкой, чтобы вы могли убедиться, что выбрали правильные файлы. Это может работать только с форматом .mp4, я просто знаю, что это не сработало с форматом .avi, который я пробовал.
Отключение этого параметра сэкономит несколько секунд на обработке каждого видео.

### preview_settings
Это позволит отрисовать только 1 кадр вашего видео и отобразить его в полном размере, чтобы вы могли изменить настройки без необходимости каждый раз отрисовывать все видео целиком.
frame_to_preview предназначен для выбора конкретного кадра, который вы хотите просмотреть, и может не полностью соответствовать фактическому кадру.
